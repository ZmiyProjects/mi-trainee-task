# Как запустить?

Скопировать на локальное устройство и запустить контейнер в корневой директории проекта:

git clone https://github.com/ZmiyProjects/mi-trainee-task
sudo docker-compose up

с текущими настройками веб-сервис запускается на 0.0.0.0:8080

# Запуск тестов

Для запуска понадобится виртуальное окружение python3.7 с установленными модулями pytest и request

```sh
cd tests/
python3.7 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pytest
```

Файл test_config.json содержит конфигурацию (хост и порт) для запуска тестов, по умолчанию это:

```json
{
    "host": "0.0.0.0",
    "port": "8080"
}
```

# Обработчики API

## Метод `POST /generate` принимает структуру с кодовой фразой и датой удаления в формате:

```json
{
    "secret": "some secret text",
    "phrase": "key phrase to unlock a secret",
    "before_delete": {
        "seconds": 59,
        "minutes": 59,
        "hours": 23,
        "days": 6
    } 
}
```
`secrets` -- текст секрета
`phrase` -- ключавая фраза, используемая для разблокировки секрета

Если на входе пустая структура, или отсутствуют атрибуты `secret` и/или `phrase` запрос
будет отклонен и сервис вернет статус `HTTP 400 Bad Request`.

Сервис осуществляет удаление секретов по таймеру, для этого при создании секрета необходимо указать срок удаления `before_delete` с атрибутами
`seconds` -- секунды до удаления от 0 до 59
`minutes` -- минуты до удаления от 0 до 59
`hours` -- часы до удаления от 0 до 23
`days` -- дни до удаления от 0 до 23

Если дата удаления некорректра сервис отклонит запрос и вернет `HTTP 400`

Сервис не гарантирует игновенное удаление секретов по настулению времени удаления, может пройти несколько секунд до фактического удаления секрета
При этом атрибут `before_delete` может отсутствовать, в таком случае секрет не будет удален по таймеру.

Если секрет успешно создан сервис вернет статус `HTTP 201 Created` и json содержащий ключ, по которому можно получит секрет зная кодовую фразу:

```json	
{
    "data": "96061e92f58e4bdcdee73df36183fe3ac64747c81c26f6c83aada8d2aabb1864"
}
``` 


## Метод `GET /secrets/{secret_key}` принимает на вход структуру с кодовой фразой и если она совпадает с указанной при создании, возвращает json с секретом:

```json
{
    "phrase": "key phrase to unlock a secret"
}
```

Если фраза совпадает с указанной при создании секрета возвращает `HTTP 200 Successful` и структуры с секретом, а секрет удаляется из базы данных:

```json
{
    "data": "some secret text"
}
```

Если json на входе не содержит атрибут `phrase` -- сервис вернет `HTTP 400`

Если секрет с указанным секретным кодом не существует (не важно, существовал ли он ранее) сервис вернет `HTTP 400`

Если секрет существует, но ключевая фраза не соответствует заданной при создании -- сервис вернет `HTTP 403 Forbidden`

